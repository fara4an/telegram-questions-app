<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–æ–Ω–∏–º–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã | Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –°–¢–ò–õ–ò –û–°–¢–ê–Æ–¢–°–Ø –¢–ê–ö–ò–ú–ò –ñ–ï –ö–ê–ö –£ –í–ê–° –ë–´–õ–ò */
        /* –Ø –Ω–µ –º–µ–Ω—è—é —Å—Ç–∏–ª–∏, —Ç–æ–ª—å–∫–æ JavaScript */
    </style>
</head>
<body>
    <div class="app-container" id="app">
        <!-- –í–ï–†–°–¢–ö–ê –û–°–¢–ê–Å–¢–°–Ø –¢–ê–ö–û–ô –ñ–ï -->
        <!-- –Ø –Ω–µ –º–µ–Ω—è—é HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—É -->
    </div>

    <script>
        // Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        let tg = window.Telegram?.WebApp;
        let userId = null;
        let username = null;
        let questions = [];
        let isDemoMode = false;
        
        // ========== –û–°–ù–û–í–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        async function initTelegram() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤ Telegram –ª–∏ –º—ã
            if (tg) {
                try {
                    tg.ready();
                    tg.expand();
                    
                    const initData = tg.initDataUnsafe;
                    userId = initData.user?.id;
                    username = initData.user?.username || `user_${userId}`;
                    
                    console.log('Telegram User ID:', userId);
                    
                    if (!userId) {
                        showError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                        return;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º UI
                    updateUserInfo();
                    
                    // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç (–Ω–µ –∂–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏)
                    showContent();
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –≤ —Ñ–æ–Ω–µ
                    loadQuestions();
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram:', error);
                    initDemoMode();
                }
            } else {
                // –†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–±—Ä–∞—É–∑–µ—Ä)
                console.log('üì± –†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ');
                initDemoMode();
            }
        }

        // ========== –û–¢–õ–ê–î–û–ß–ù–´–ô –†–ï–ñ–ò–ú ==========
function enableDebugMode() {
    console.log('=== DEBUG MODE ENABLED ===');
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
    loadDemoData();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    document.getElementById('questions-list').innerHTML = `
        <div class="card" style="border-left-color: #667eea;">
            <h3>üîç –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <p><strong>User ID:</strong> ${userId}</p>
            <p><strong>Username:</strong> ${username}</p>
            <p><strong>Telegram:</strong> ${tg ? '–î–∞' : '–ù–µ—Ç'}</p>
            <p><strong>–î–µ–º–æ —Ä–µ–∂–∏–º:</strong> ${isDemoMode ? '–î–∞' : '–ù–µ—Ç'}</p>
            <p><strong>–í–æ–ø—Ä–æ—Å–æ–≤ –≤ –ø–∞–º—è—Ç–∏:</strong> ${questions.length}</p>
            <div style="margin-top: 15px;">
                <button class="btn btn-primary" onclick="testApiConnection()">
                    üîÑ –¢–µ—Å—Ç API
                </button>
                <button class="btn btn-secondary" onclick="location.reload()">
                    ‚Ü©Ô∏è –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
                </button>
            </div>
        </div>
    `;
}

// –¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å API
async function testApiConnection() {
    try {
        const response = await fetch(`/api/questions/${userId}`);
        const data = await response.json();
        alert(`‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç! –û—Ç–≤–µ—Ç: ${JSON.stringify(data).substring(0, 100)}...`);
        console.log('API Response:', data);
        
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã
        loadQuestions();
    } catch (error) {
        alert(`‚ùå API –æ—à–∏–±–∫–∞: ${error.message}`);
    }
}

// –ó–∞–º–µ–Ω–∏—Ç–µ –≤—ã–∑–æ–≤ initTelegram –≤ –∫–æ–Ω—Ü–µ —Ñ–∞–π–ª–∞ –Ω–∞:
document.addEventListener('DOMContentLoaded', function() {
    console.log('=== APP STARTED ===');
    
    // –î–∞—ë–º 2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –æ–±—ã—á–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
    setTimeout(function() {
        // –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å, –≤–∫–ª—é—á–∞–µ–º –æ—Ç–ª–∞–¥–∫—É
        if (questions.length === 0 && document.getElementById('questions-list').innerHTML.includes('loading')) {
            console.log('–í–æ–ø—Ä–æ—Å—ã –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å, –≤–∫–ª—é—á–∞–µ–º –æ—Ç–ª–∞–¥–∫—É...');
            enableDebugMode();
        }
    }, 2000);
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—ã—á–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
    initTelegram();
});
        
        // ========== –†–ï–ñ–ò–ú –î–ï–ú–û (–µ—Å–ª–∏ Telegram –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω) ==========
        function initDemoMode() {
            isDemoMode = true;
            userId = 'demo_' + Date.now();
            username = '–î–µ–º–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-—Ä–µ–∂–∏–º
            document.getElementById('userInfo').innerHTML = `
                <div style="background: #ffeaa7; color: #333; padding: 10px; border-radius: 5px;">
                    üîß –î–µ–º–æ-—Ä–µ–∂–∏–º (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
                </div>
            `;
            
            updateUserInfo();
            showContent();
            loadDemoData();
        }
        
        // ========== –ü–û–ö–ê–ó–ê–¢–¨ –ö–û–ù–¢–ï–ù–¢ –ù–ï–ú–ï–î–õ–ï–ù–ù–û ==========
        function showContent() {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∑–∞–≥—Ä—É–∑–∫–∏
            hideAllLoading();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            document.getElementById('profile-username').textContent = username;
            document.getElementById('profile-userid').textContent = userId;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É
            const botUsername = '–≤–∞—à_–±–æ—Ç_username'; // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –ò–ú–Ø –í–ê–®–ï–ì–û –ë–û–¢–ê
            const shareLink = `https://t.me/${botUsername}?start=ask_${userId}`;
            document.getElementById('share-link').textContent = shareLink;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            updateConnectionStatus('üü¢ –ì–æ—Ç–æ–≤–æ');
        }
        
        // ========== –ó–ê–ì–†–£–ó–ö–ê –í–û–ü–†–û–°–û–í ==========
        async function loadQuestions() {
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userId);
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç 5 —Å–µ–∫—É–Ω–¥
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('–¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏')), 5000)
                );
                
                // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å API
                const fetchPromise = fetch(`/api/questions/${userId}`);
                
                const response = await Promise.race([fetchPromise, timeoutPromise]);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                questions = await response.json();
                
                if (!Array.isArray(questions)) {
                    throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                }
                
                console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤:', questions.length);
                
                // –†–µ–Ω–¥–µ—Ä–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                renderQuestions();
                renderAnswers();
                updateStats();
                updateBadge();
                
                if (questions.length === 0) {
                    showEmptyState();
                }
                
            } catch (error) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã:', error.message);
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                loadDemoData();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                showApiWarning();
            } finally {
                // –í—Å–µ–≥–¥–∞ —Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏
                hideAllLoading();
            }
        }
        
        // ========== –î–ï–ú–û-–î–ê–ù–ù–´–ï ==========
        function loadDemoData() {
            questions = [
                {
                    id: 1,
                    text: "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –¥–µ–º–æ-–≤–æ–ø—Ä–æ—Å 1",
                    answer: null,
                    is_answered: false,
                    created_at: new Date().toISOString(),
                    from_username: '–ê–Ω–æ–Ω–∏–º'
                },
                {
                    id: 2,
                    text: "–ö–∞–∫ —Ç–µ–±–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?",
                    answer: "–ü–æ–∫–∞ –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç!",
                    is_answered: true,
                    created_at: new Date(Date.now() - 86400000).toISOString(),
                    answered_at: new Date().toISOString(),
                    from_username: '–ê–Ω–æ–Ω–∏–º'
                },
                {
                    id: 3,
                    text: "–ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ—à—å –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ?",
                    answer: null,
                    is_answered: false,
                    created_at: new Date(Date.now() - 172800000).toISOString(),
                    from_username: '–î—Ä—É–≥'
                }
            ];
            
            renderQuestions();
            renderAnswers();
            updateStats();
            updateBadge();
        }
        
        // ========== –†–ï–ù–î–ï–†–ò–ù–ì –í–û–ü–†–û–°–û–í ==========
        function renderQuestions() {
            const container = document.getElementById('questions-list');
            if (!container) return;
            
            const unanswered = questions.filter(q => !q.is_answered);
            
            if (unanswered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <h3>–ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤</h3>
                        <p>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–µ–π —Å—Å—ã–ª–∫–æ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã</p>
                        <button class="btn btn-primary" onclick="shareToTelegram()" style="margin-top: 15px;">
                            üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = unanswered.map(q => `
                <div class="card question-card">
                    <div class="question-meta">
                        ${formatDate(q.created_at)}
                        ${q.from_username ? `¬∑ –û—Ç: ${escapeHtml(q.from_username)}` : '¬∑ –ê–Ω–æ–Ω–∏–º'}
                        ${isDemoMode ? '<span style="color: #ffa502; margin-left: 10px;">[–î–µ–º–æ]</span>' : ''}
                    </div>
                    <div class="question-text">${escapeHtml(q.text)}</div>
                    <div class="answer-section">
                        <textarea 
                            id="answer-${q.id}" 
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç..." 
                            rows="3"
                        ></textarea>
                        <div class="buttons">
                            <button class="btn btn-success" onclick="submitAnswer(${q.id})">
                                ‚úÖ –û—Ç–≤–µ—Ç–∏—Ç—å
                            </button>
                            <button class="btn btn-danger" onclick="deleteQuestion(${q.id})">
                                ‚ùå –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // ========== –†–ï–ù–î–ï–†–ò–ù–ì –û–¢–í–ï–¢–û–í ==========
        function renderAnswers() {
            const container = document.getElementById('answers-list');
            if (!container) return;
            
            const answered = questions.filter(q => q.is_answered);
            
            if (answered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì§</div>
                        <h3>–ù–µ—Ç –æ—Ç–≤–µ—á–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤</h3>
                        <p>–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Ö–æ–¥—è—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = answered.map(q => `
                <div class="card question-card">
                    <div class="question-meta">
                        ${formatDate(q.created_at)}
                        ${q.answered_at ? `¬∑ –û—Ç–≤–µ—Ç: ${formatDate(q.answered_at)}` : ''}
                        ${isDemoMode ? '<span style="color: #ffa502; margin-left: 10px;">[–î–µ–º–æ]</span>' : ''}
                    </div>
                    <div class="question-text">${escapeHtml(q.text)}</div>
                    <div class="answer-bubble">
                        <strong>–í–∞—à –æ—Ç–≤–µ—Ç:</strong><br>
                        ${escapeHtml(q.answer)}
                    </div>
                    <div class="buttons">
                        <button class="btn btn-primary" onclick="shareAnswer(${q.id})">
                            üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                        </button>
                        <button class="btn btn-danger" onclick="deleteQuestion(${q.id})">
                            ‚ùå –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // ========== –û–¢–ü–†–ê–í–ö–ê –û–¢–í–ï–¢–ê ==========
        async function submitAnswer(questionId) {
            const answerText = document.getElementById(`answer-${questionId}`).value.trim();
            
            if (!answerText) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç');
                return;
            }
            
            try {
                const response = await fetch(`/api/questions/${questionId}/answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ answer: answerText })
                });
                
                if (response.ok) {
                    showAlert('‚úÖ –û—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                    const question = questions.find(q => q.id === questionId);
                    if (question) {
                        question.answer = answerText;
                        question.is_answered = true;
                        question.answered_at = new Date().toISOString();
                        renderQuestions();
                        renderAnswers();
                        updateStats();
                        updateBadge();
                    }
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                showAlert('‚úÖ –û—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ!');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                const question = questions.find(q => q.id === questionId);
                if (question) {
                    question.answer = answerText;
                    question.is_answered = true;
                    question.answered_at = new Date().toISOString();
                    renderQuestions();
                    renderAnswers();
                    updateStats();
                    updateBadge();
                }
            }
        }
        
        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                const now = new Date();
                const diff = now - date;
                
                // –ú–µ–Ω—å—à–µ –º–∏–Ω—É—Ç—ã –Ω–∞–∑–∞–¥
                if (diff < 60000) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
                
                // –ú–µ–Ω—å—à–µ —á–∞—Å–∞ –Ω–∞–∑–∞–¥
                if (diff < 3600000) return `${Math.floor(diff / 60000)} –º–∏–Ω –Ω–∞–∑–∞–¥`;
                
                // –°–µ–≥–æ–¥–Ω—è
                if (date.toDateString() === now.toDateString()) {
                    return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                }
                
                // –í—á–µ—Ä–∞
                const yesterday = new Date(now);
                yesterday.setDate(yesterday.getDate() - 1);
                if (date.toDateString() === yesterday.toDateString()) {
                    return `–≤—á–µ—Ä–∞ ${date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}`;
                }
                
                // –°—Ç–∞—Ä—à–µ
                return date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
            } catch {
                return '–Ω–µ–¥–∞–≤–Ω–æ';
            }
        }
        
        function updateUserInfo() {
            const userInfoEl = document.getElementById('userInfo');
            if (userInfoEl) {
                userInfoEl.innerHTML = `
                    üë§ ${username}<br>
                    <small>ID: ${userId}</small>
                `;
            }
        }
        
        function updateStats() {
            const total = questions.length;
            const answered = questions.filter(q => q.is_answered).length;
            const pending = total - answered;
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-answered').textContent = answered;
            document.getElementById('stat-pending').textContent = pending;
        }
        
        function updateBadge() {
            const badge = document.getElementById('questions-badge');
            const pending = questions.filter(q => !q.is_answered).length;
            
            if (pending > 0) {
                badge.textContent = pending;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }
        
        function updateConnectionStatus(status) {
            const statusEl = document.getElementById('connection-status');
            if (statusEl) {
                statusEl.textContent = status;
            }
        }
        
        function hideAllLoading() {
            document.querySelectorAll('.loading').forEach(el => {
                el.style.display = 'none';
            });
        }
        
        function showApiWarning() {
            const questionsList = document.getElementById('questions-list');
            if (questionsList && !isDemoMode) {
                questionsList.innerHTML = `
                    <div class="card" style="border-left-color: #ffa502;">
                        <div style="text-align: center; color: #ffa502;">
                            ‚ö†Ô∏è <b>–í–Ω–∏–º–∞–Ω–∏–µ</b><br>
                            <small>–°–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ.</small><br>
                            <button class="btn btn-secondary" onclick="loadQuestions()" style="margin-top: 10px; padding: 8px 16px;">
                                üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É
                            </button>
                        </div>
                    </div>
                    ${questionsList.innerHTML}
                `;
            }
        }
        
        function showError(message) {
            const container = document.getElementById('questions-list');
            if (container) {
                container.innerHTML = `
                    <div class="card" style="border-left-color: #ff4757; text-align: center;">
                        <div style="color: #ff4757; font-size: 20px;">‚ö†Ô∏è</div>
                        <h3>–û—à–∏–±–∫–∞</h3>
                        <p>${message}</p>
                        <button class="btn btn-primary" onclick="location.reload()" style="margin-top: 10px;">
                            üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                        </button>
                    </div>
                `;
            }
        }
        
        function showEmptyState() {
            const container = document.getElementById('questions-list');
            if (container) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìù</div>
                        <h3>–ü–æ–∫–∞ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤</h3>
                        <p>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–µ–π —Å—Å—ã–ª–∫–æ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã</p>
                        <button class="btn btn-primary" onclick="shareToTelegram()" style="margin-top: 15px;">
                            üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π
                        </button>
                    </div>
                `;
            }
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function showAlert(message) {
            if (tg) {
                tg.showAlert(message);
            } else {
                alert(message);
            }
        }
        
        // ========== –û–ë–©–ò–ï –§–£–ù–ö–¶–ò–ò ==========
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            document.getElementById(`tab-${tabName}`).classList.add('active');
            document.getElementById(`page-${tabName}`).classList.add('active');
        }
        
        async function copyLink() {
            const link = document.getElementById('share-link').textContent;
            try {
                await navigator.clipboard.writeText(link);
                showAlert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
            } catch (error) {
                showAlert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å');
            }
        }
        
        function shareToTelegram() {
            const link = document.getElementById('share-link').textContent;
            const text = `–ó–∞–¥–∞–π –º–Ω–µ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –≤–æ–ø—Ä–æ—Å! ${link}`;
            
            if (tg) {
                tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent('–ó–∞–¥–∞–π –º–Ω–µ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –≤–æ–ø—Ä–æ—Å!')}`);
            } else {
                window.open(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent('–ó–∞–¥–∞–π –º–Ω–µ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –≤–æ–ø—Ä–æ—Å!')}`, '_blank');
            }
        }
        
        function shareAnswer(questionId) {
            const question = questions.find(q => q.id === questionId);
            if (!question) return;
            
            const text = `–í–æ–ø—Ä–æ—Å: ${question.text}\n\n–û—Ç–≤–µ—Ç: ${question.answer}`;
            
            if (tg) {
                tg.shareText(text);
            } else {
                showAlert('–§—É–Ω–∫—Ü–∏—è "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ Telegram');
            }
        }
        
        function deleteQuestion(questionId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å?')) return;
            
            // –£–¥–∞–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
            questions = questions.filter(q => q.id !== questionId);
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º
            renderQuestions();
            renderAnswers();
            updateStats();
            updateBadge();
            
            showAlert('‚ùå –í–æ–ø—Ä–æ—Å —É–¥–∞–ª—ë–Ω');
        }
        
        // ========== –ó–ê–ü–£–°–ö –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ==========
        document.addEventListener('DOMContentLoaded', initTelegram);
    </script>
</body>
</html>